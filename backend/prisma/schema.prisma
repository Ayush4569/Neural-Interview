generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
id String @id @default(cuid())
username String?
name String?
email String? @unique
image String?
emailVerified DateTime?
interviews Interview[]
accounts Account[]
sessions Session[] 
createdAt DateTime @default(now())
updatedAt DateTime @updatedAt
}
model Account {
id String @id @default(cuid())
userId String
type String
provider String
providerAccountId String
refresh_token String? @db.Text
access_token String? @db.Text
expires_at Int?
token_type String?
scope String?
id_token String? @db.Text
session_state String?

user User @relation(fields: [userId], references: [id], onDelete: Cascade)

@@unique([provider, providerAccountId])
}

model Session {
id String @id @default(cuid())
sessionToken String @unique
userId String
expires DateTime

user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}
model Interview {
  id String @id @default(cuid())
  userId String
  user User @relation(fields: [userId],references: [id])
  startTime DateTime? 
  endTime DateTime? 
  techStack String
  durationMinutes Int 
  expLevel Experience @default(fresher)
  createdAt DateTime @default(now())
  status InterviewStatus @default(scheduled)
  jobTitle String
  additionalPrompt String?
  summary Summary?
  vapisession VapiSession? 

  @@index([userId,status])
}
model VapiSession {
  id               String              @id @default(cuid())
  interviewId      String              @unique
  interview        Interview           @relation(fields: [interviewId], references: [id])
  

  vapiCallId       String              @unique  // Vapi's call ID
  vapiSessionUrl   String              @unique  // Join URL from Vapi
  
  // Session Lifecycle
  status           VapiSessionStatus   @default(pending)
  startedAt        DateTime?           // When call actually started
  endedAt          DateTime?           // When call actually ended
  recordingUrl     String?             // Recording from Vapi
  
  // Token Management
  createdAt        DateTime            @default(now())
  expiresAt        DateTime            // When session expires
  
  @@index([vapiCallId])
  @@index([status])
}

model Summary {
  id               String           @id @default(cuid())
  interviewId      String           @unique
  interview        Interview        @relation(fields: [interviewId], references: [id])
  
  // Summary Content
  overallSummary   String
  strengths        String[]        
  improvements     String[]        
  technicalScore   Int?            
  communicationScore Int?         
  
  // Summary state
  status           SummaryStatus    @default(processing)
  processedAt      DateTime?
  
  createdAt        DateTime         @default(now())
  
  @@index([status])
}
enum Provider {
  local
  google
  github
  discord
}
enum Experience {
  fresher
  mid
  lead
  senior
}
enum InterviewStatus {
  scheduled
  completed
  active
  expired
}
enum VapiSessionStatus {
  active
  failed
  pending
  completed
}
enum SummaryStatus {
  processing
  pending
  completed
  failed
}